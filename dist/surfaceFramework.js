// deno-lint-ignore-file
var mt=Object.defineProperty;var o=(e,t)=>mt(e,"name",{value:t,configurable:!0});var T=(e,t)=>{for(var i in t)mt(e,i,{get:t[i],enumerable:!0})};var A={};T(A,{default:()=>I});var B={};T(B,{default:()=>u});var u=class{static{o(this,"TextElem")}id=0;activeView=!1;enabled=!1;hovered=!1;focused=!1;path=new Path2D;index=0;zOrder=0;tabOrder=0;name;size;textSize;location;textLocation;padding=10;strokeColor="black";fillColor;fontColor;fontSize;text;lastText;hasBorder=!1;fill=!0;textAlign;textBaseline;TextLocation;boundingBox={left:0,top:0,width:0,height:0};constructor(t){this.name=t.id,this.index=t.idx,this.text=t.text??"",this.lastText="",this.size=t.size??{width:30,height:30},this.textSize={width:this.size.width,height:this.size.height},this.location=t.location,this.boundingBox={left:this.location.left,top:this.location.top,width:this.size.width,height:this.size.height},this.fillColor=t.color??"transparent",this.fontColor=t.fontColor||"black",this.fontSize=t.fontSize||18,this.padding=t.padding||10,this.textAlign=t.textAlign||"center",this.textBaseline=t.textBaseline??"middle",this.TextLocation=t.TextLocation??"middle",this.textLocation={left:t.location.left,top:t.location.top},this.fill=t.fill??!0,this.hasBorder=t.hasBoarder??!1,this.calculateMetrics(),t.bind&&l.on("UpdateText",this.name,i=>{this.calculateMetrics(),this.hasBorder=i.border,this.fill=i.fill,this.fillColor=i.fillColor,this.fontColor=i.fontColor,this.lastText=i.text,this.text=i.text,this.update()})}update(){this.calculateMetrics()}render(){if(!s)return;s.save(),s.font=`${this.fontSize}px Tahoma, Verdana, sans-serif`,s.textAlign=this.textAlign,s.textBaseline=this.textBaseline,this.fill===!0&&(s.fillStyle=this.fillColor,s.fillRect(this.location.left,this.location.top,this.size.width,this.size.height));let t=this.boundingBox;this.hasBorder===!0&&(s.lineWidth=1,s.strokeStyle="black",s.strokeRect(t.left,t.top,t.width,t.height)),s.fillStyle=this.fontColor,s.fillText(this.text+" ",this.textLocation.left,this.textLocation.top),s.restore()}touched(){}calculateMetrics(){switch(this.TextLocation){case"top":this.textLocation.top=this.location.top+this.padding;break;case"middle":this.textLocation.top=this.location.top+this.size.height*.5;break;default:this.textLocation.top=this.location.top+this.padding;break}switch(this.textAlign){case"left":this.textLocation.left=this.location.left+this.padding;break;case"center":this.textLocation.left=this.location.left+this.size.width*.5;break;case"right":this.textLocation.left=this.location.left+this.padding;break;default:this.textLocation.left=this.location.left+this.padding;break}this.render()}};var I=class{static{o(this,"Button")}id=0;activeView=!0;index=-1;zOrder=0;tabOrder=0;name="";enabled=!0;hovered=!1;focused=!1;path;size;location;color;fontColor;textNode;boarderWidth;text="";constructor(t){this.name=t.id,this.zOrder=0,this.tabOrder=t.tabOrder||0,this.location=t.location,this.boarderWidth=t.boarderWidth||1,this.size=t.size||{width:50,height:30},this.enabled=!0,this.path=this.buildPath(t.radius||10),this.textNode=new u({kind:"TextElem",idx:-1,tabOrder:0,id:this.name+"Label",text:t.text||"",location:{left:this.location.left+10,top:this.location.top+10},size:{width:this.size.width-20,height:this.size.height-20},fontSize:t.fontSize||18,bind:!0}),this.color=t.color||"red",this.fontColor=t.fontColor||"white",this.text=t.text||"??",this.render(),l.on("UpdateButton",this.name,i=>{this.enabled=i.enabled,this.color=i.color,this.text=i.text,this.update()})}buildPath(t){let i=new Path2D;return i.roundRect(this.location.left,this.location.top,this.size.width,this.size.height,t),i}touched(){this.enabled&&l.fire("ButtonTouched",this.name,null)}update(){this.render()}render(){s.save(),s.lineWidth=this.boarderWidth,s.strokeStyle=this.hovered?"orange":"black",s.stroke(this.path),s.fillStyle=this.color,s.fill(this.path),s.fillStyle="white",s.restore(),this.textNode.fillColor=this.color,this.textNode.fontColor=this.fontColor,this.textNode.text=this.text,this.textNode.update()}};var X={};T(X,{default:()=>O});var O=class{static{o(this,"CheckBox")}id=0;activeView=!0;index=-1;zOrder=0;tabOrder=0;name="";enabled=!0;hovered=!1;focused=!1;path;size;location;color;fontColor;boarderWidth;fontSize;text="";checked=!1;constructor(t){this.name=t.id,this.zOrder=0,this.tabOrder=t.tabOrder||0,this.location=t.location;let{left:i,top:n}=t.location;this.boarderWidth=t.boarderWidth||1,this.size=t.size||{width:50,height:30};let{width:h,height:r}=this.size;this.enabled=!0,this.path=this.buildPath(t.radius||0),this.color=t.color||"red",this.fontColor=t.fontColor||"white",this.text=t.text||"??",this.fontSize=t.fontSize||24,this.render(),l.on("UpdateCheckBox",this.name,a=>{this.checked=a.checked,this.color=a.color,this.text=a.text,this.update()})}buildPath(t){let i=new Path2D;return i.roundRect(this.location.left,this.location.top,this.size.width,this.size.height,t),i}touched(){this.enabled&&l.fire("CheckBoxTouched",this.name,{checked:this.enabled})}update(){this.render()}render(){s.save(),s.lineWidth=8,s.strokeStyle=this.hovered?"orange":"black",s.stroke(this.path),s.fillStyle=this.color,s.fill(this.path),s.fillStyle="white",s.restore(),s.save(),s.font=`${this.fontSize}px Tahoma, Verdana, sans-serif`,s,s.textAlign="center",s.textBaseline="middle",s.fillStyle="limegreen",s.fillRect(this.location.left,this.location.top,this.size.width,this.size.height),s.fillStyle=this.fontColor;let t=this.location.top+this.size.height*.5,i=this.location.left+this.size.width*.5;s.fillText(this.text+" ",i,t),s.restore()}};var N={};T(N,{default:()=>z});var v=class{static{o(this,"Scrollbar")}container;mousePos=0;dragging=!1;hovered=!1;visible=!0;left=0;top=0;width=0;height=0;fill;cursor;path;constructor(t){this.container=t,this.left=t.left+t.width-t.scrollBarWidth,this.top=t.top,this.height=t.height,this.width=t.scrollBarWidth,this.fill="#dedede",this.cursor={index:0,top:0,bottom:t.height-t.scrollBarWidth,left:this.left+this.width-t.scrollBarWidth,width:t.scrollBarWidth,length:t.scrollBarWidth,fill:"#bababa"},this.path=new Path2D,this.path.rect(this.left,this.top,this.width-2,this.height),this.mousePos=0}render(t,i){let n=i/t;this.cursor.length=100,s.save(),s.fillStyle=this.fill,s.fill(this.path),s.fillStyle="red",s.fillRect(this.cursor.left,this.container.top+this.cursor.top,this.cursor.width,this.cursor.length),s.lineWidth=2,s.strokeStyle=this.hovered?"orange":"#bababa",s.stroke(this.path),s.restore()}scroll(t){let{height:i,lineHeight:n,rowCapacity:h,top:r}=this.container;this.cursor.index-=t,this.cursor.index<0&&(this.cursor.index=0);let a=this.cursor.index*n;a+this.cursor.length>=i+r||(this.cursor.top=a),this.cursor.top<0&&(this.cursor.top=0),this.container.render()}};var z=class{static{o(this,"Container")}id=0;activeView=!0;index=1;zOrder=0;tabOrder=0;name="";enabled=!0;hovered=!1;focused=!1;path;height;width;padding=10;left=0;top=0;color;lineHeight=0;showPlaceholder=!0;scrollBarWidth=25;textCapacity=0;rowCapacity=0;scrollBar;constructor(t){this.name=t.id,this.tabOrder=t.tabOrder||0,this.left=t.location.left,this.top=t.location.top,this.width=t.size?.width??100,this.height=t.size?.height??40,this.color=t.color||"white",this.path=new Path2D,this.path.rect(this.left,this.top,this.width,this.height),this.scrollBar=new v(this),l.on("Scroll","",i=>{this.scrollBar.scroll(i.deltaY)}),l.on("TextMetrics",this.name,i=>{this.textCapacity=i.capacity.columns-1,this.rowCapacity=i.capacity.rows})}touched(){}update(){this.render()}render(){s.save(),s.lineWidth=2,this.focused===!1?(s.strokeStyle=this.hovered?"orange":"black",s.fillStyle=this.color):(s.strokeStyle="blue",s.fillStyle="white"),s.stroke(this.path),s.fill(this.path),s.restore(),this.focused===!0&&this.scrollBar.render(50,27)}};var H={};T(H,{default:()=>W});var gt=1,wt=1,W=class{static{o(this,"Popup")}id=0;index=-1;activeView=!0;zOrder=0;tabOrder=0;name="";enabled=!0;hovered=!1;focused=!1;path;shownPath;hiddenPath;location;size;color="black";textNode;text="";fontColor="red";fontSize=28;visible=!0;constructor(t){this.tabOrder=t.tabOrder||0,this.enabled=!0,this.color="white",this.location=t.location,this.hiddenPath=new Path2D,this.hiddenPath.rect(1,1,1,1),this.size=t.size||{width:300,height:300},this.shownPath=this.buildPath(t.radius||30),this.path=this.hiddenPath,this.fontSize=t.fontSize||24,this.textNode=new u({kind:"TextElem",idx:-1,tabOrder:0,id:this.name+"Label",text:t.text||"",location:this.location,size:this.size,bind:!0}),l.on("ShowPopup","",i=>{this.show(i.msg)}),l.on("HidePopup","",()=>this.hide())}buildPath(t){let i=new Path2D;return i.roundRect(this.location.left,this.location.top,this.size.width,this.size.height,t),i}show(t){l.fire("FocusPopup"," ",this),this.text=t[0],gt=this.location.left,wt=this.location.top,this.path=this.shownPath,this.visible=!0,D(!0),this.render()}hide(){this.visible&&(gt=1,wt=1,this.path=this.hiddenPath,this.visible=!1,D(!1))}touched(){this.hide(),l.fire("PopupReset","",null)}update(){this.visible&&this.render()}render(){s.save(),s.shadowColor="#404040",s.shadowBlur=45,s.shadowOffsetX=5,s.shadowOffsetY=5,s.fillStyle=x.containerColor,s.fill(this.path),s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0,s.lineWidth=1,s.strokeStyle=x.textColor,s.stroke(this.path),this.textNode.fontSize=this.fontSize,this.textNode.fillColor=this.color,this.textNode.fontColor=this.fontColor,this.textNode.text=this.text,this.textNode.update(),s.restore(),this.visible=!0}};var V={};T(V,{default:()=>M});var Ct="\u200A",Y="|",L="\u200B",ue="\u270D",pe="\u274C",xe="\u2702",me="\u2705",ge="\u{1F9FA}",we="\u2714";var $=Ct,It="text",M=class extends z{static{o(this,"TextArea")}id=0;activeView=!0;index=1;zOrder=0;tabOrder=0;name="";enabled=!0;hovered=!1;focused=!1;log=!1;path;size;padding=10;location;color;fontColor;lineHeight=0;text="";lines=[];trimmedLeft="";trimmedRight="";insertionColumn=0;insertionRow=0;selectStart=0;selectEnd=0;widthPerChar=15;solidCaret=!0;textCapacity=0;rowCapacity=0;showPlaceholder=!0;fontSize;constructor(t){super(t),this.name=t.id,this.tabOrder=t.tabOrder||0,this.location=t.location,this.size=t.size||{width:100,height:40},this.color=t.color||"white",this.fontColor="black",this.fontSize=t.fontSize||28,this.getMetrics(),this.path=new Path2D,this.path.rect(this.location.left,this.location.top,this.size.width,this.size.height),l.fire("TextMetrics",this.name,{size:this.size,capacity:{rows:this.rowCapacity,columns:this.textCapacity}}),l.on("Blink","",i=>{this.solidCaret=i,this.render(),console.log("Blink")}),l.on("UpdateTextArea",this.name,i=>{let{_reason:n,text:h,lines:r,focused:a,insertionColumn:d,insertionRow:E,selectStart:f,selectEnd:S}=i;this.insertionColumn=d,this.insertionRow=E,this.selectStart=f,this.selectEnd=S,this.focused=a,this.lines=r,this.text=h,this.showPlaceholder=this.text.length===0,this.focused===!0&&($=Y);let y="";for(let Bt of this.lines)y+=`${JSON.stringify(Bt)}
            `;!0&&console.log(` 
         focused: ${this.focused} insertionRow: ${this.insertionRow} 
         highlighted text: ${h.substring(this.selectStart,this.selectEnd)}
         selection -- start: ${this.selectStart}, end: ${this.selectEnd} 
         insertion -- row: ${this.insertionRow}, column: ${this.insertionColumn}
         ${y}`,"TextArea.UpdateTextArea"),this.render()}),this.render()}getMetrics(){s.font=`${this.fontSize}px Tahoma, Verdana, sans-serif`;let t="This is a test! A very very long text!",i=s.measureText(t);this.lineHeight=i.fontBoundingBoxAscent+i.fontBoundingBoxDescent,this.size.height=this.size.height,this.widthPerChar=i.width/t.length,this.textCapacity=this.size.width/this.widthPerChar}getUnusedSpace(){return this.size.width-s.measureText(this.text).width}touched(){l.fire("TextViewTouched",this.name,null)}update(){this.render()}render(){super.render(),s.textAlign="left",s.textBaseline="alphabetic",s.save(),this.focused===!0?$=Y:$="";let t=0;for(let i of this.lines){if(i.length<=0)continue;let n=this.location.top+this.lineHeight*(t+1);if(this.showPlaceholder&&this.focused===!1)s.fillStyle="Gray",s.fillText(It,this.location.left+this.padding,n);else{let h="";this.positionCaret(i.text),i.hasSelection&&this.renderHighlight(i),h=this.insertionRow===t?this.trimmedLeft+$+this.trimmedRight:i.text,s.fillStyle=this.fontColor,s.fillText(h,this.location.left+this.padding,n)}s.restore(),t++}}positionCaret(t){let i=this.insertionColumn;this.trimmedLeft=t.substring(0,i),this.trimmedRight=t.substring(i)}renderHighlight(t){let{lineHeight:i,padding:n,location:h,selectStart:r,selectEnd:a,text:d}=this,E=r<=t.start?0:s.measureText(d.substring(t.start,r)).width,f=r>t.start?r:t.start,S=a>=t.end?t.end:a,y=s.measureText(d.substring(f,S)).width,xt=h.top+i*t.index+n;s.fillStyle="lightblue",s.fillRect(h.left+n+E,xt,y,i)}};var At={views:{"./views/Button.js":A,"./views/CheckBox.js":X,"./views/Container.js":N,"./views/Popup.js":H,"./views/TextElem.js":B,"./views/TextArea.js":V},baseUrl:import.meta.url},bt=At;var l=St();function St(){let e=new Map;return{on(i,n,h){let r=i+"-"+n;e.has(r)?e.get(r).push(h):e.set(r,[h])},fire(i,n,h){let r=i+"-"+n,a=e.get(r);if(a)for(let d of a)d(h)}}}o(St,"buildSignalAggregator");var x={containerColor:"snow",textColor:"black"},K,F,J=o((e,t,i)=>{R=e,x=t.winCFG,K=t.nodes,F=i},"initCFG"),Ot="white",q=o(()=>{let e=new URL("./",F.baseUrl).href;console.log(`baseUrl ${e}`);let t=new Map;for(let[i,n]of Object.entries(bt.views)){let h=new URL(i,e).href,r=i.substring(6),a=Tt(r.substring(1,r.length-3)),d=a.toLowerCase();t.set(d,{id:d,name:a,url:h,component:n.default})}if(F.views)for(let[i,n]of Object.entries(F.views)){let h=new URL(i,e).href,r=i.substring(6),a=Tt(r.substring(1,r.length-3)),d=a.toLowerCase();t.set(d,{id:d,name:a,url:h,component:n.default})}return t},"getFactories");var k=!1,D=o(e=>k=e,"setHasVisiblePopup"),U=0,_=!0,Q=o(()=>{U++,U>60&&(U=0,_=!_,l.fire("Blink","",_))},"incrementTickCount"),R,s,Z=o(e=>{s=e.getContext("2d"),zt()},"setupRenderContext"),zt=o(()=>{s.lineWidth=1,s.strokeStyle=x.containerColor,s.fillStyle=x.containerColor,s.font="28px Tahoma, Verdana, sans-serif",s.textAlign="center"},"refreshCanvasContext");function Nt(e){return e.replace(/(^\w|-\w)/g,t=>t.replace(/-/,"").toUpperCase())}o(Nt,"toPascalCase");function Tt(e){let t=e.replace("/","");return Nt(t)}o(Tt,"sanitizeName");var m=new Set,tt=o(e=>{m.add(e),l.fire("AddedView","",{type:e.constructor.name,index:e.index,name:e.name})},"addNode"),et=o(()=>{if(Q(),s){let{width:e,height:t}=s.canvas;s.save(),s.clearRect(0,0,e,t),s.fillStyle="snow",s.fillRect(0,0,e,t),s.lineWidth=2,s.strokeStyle="black",s.strokeRect(0,0,e,t),s.restore();for(let i of m)i.update()}},"renderNodes");var Wt=0,j=0,G=0,it=null,p=!1,g=null,w=null,c=null;function rt(){addEventListener("input",e=>{c!==null&&l.fire("WindowInput",c.name,e)}),addEventListener("keydown",e=>{let t=0;if(e.code==="Tab"){if(c!==null){let i=e.shiftKey?-1:1;t=st(c.tabOrder+i,e.shiftKey)}else t=st(1,e.shiftKey);if(t===0){let i=e.shiftKey?20:1;st(i,e.shiftKey)}return}e.code==="Enter"&&(k===!0?l.fire("PopupReset","",null):c!==null&&c.touched()),c!==null&&l.fire("WindowKeyDown",c.name,e)}),addEventListener("mousedown",e=>{e.preventDefault(),e.button===Wt&&(k===!1?Ht(e.pageX,e.pageY):l.fire("PopupReset","",null))},!1),addEventListener("mousemove",e=>{e.preventDefault(),k===!1&&Dt(e)}),addEventListener("scroll",e=>{e.preventDefault()})}o(rt,"initHostEvents");function Dt(e){it=R.getBoundingClientRect(),j=e.clientX-it.x,G=e.clientY-it.y,g=null;for(let t of m)s.isPointInPath(t.path,j,G)&&(g=t);g!==null?g!==w&&(nt(),g.hovered=!0,g.update(),w=g,document.documentElement.style.cursor="hand"):w!==null&&(nt(),w=null)}o(Dt,"handleMouseMove");function Ht(e,t){j=e-R.offsetLeft,G=t-R.offsetTop,p=!1;for(let i of m)p||s.isPointInPath(i.path,j,G)&&(i.touched(),ot(),c=i,c&&l.fire("Focused",c.name,!0),p=!0);p||ot()}o(Ht,"handleClickOrTouch");function ot(){c!==null&&(c.focused=!1,c.hovered=!1,l.fire("Focused",c.name,c.focused),c.update())}o(ot,"clearFocused");function nt(){document.documentElement.style.cursor="arrow",w!==null&&(w.hovered=!1,w.update())}o(nt,"clearHovered");function st(e,t){p=!1;for(let i of m)p===!1&&i.tabOrder===e&&(ot(),nt(),c=i,c&&(c.focused=!0,c.hovered=!0,c.update(),l.fire("Focused",c.name,!0)),p=!0);return p===!1?0:e}o(st,"focusNext");var ht;function $t(e,t,i){J(e,t,i),Z(e),rt()}o($t,"containerInit");var Mt=o(()=>{et()},"renderAll"),Vt=o(()=>{ht=q();for(let e of K)kt(e)},"hydrateUI");function kt(e){let t=e.kind.toLowerCase();if(ht.has(t)){let i=ht.get(t).component;tt(new i(e))}else{let i=`No view named ${e.kind} was found! 
Make sure your view_manifest is up to date!`;throw console.error(i),new Error(i)}}o(kt,"addElement");var Rt,Ft=o(e=>{Rt=e,l.on("ButtonTouched",Rt,()=>{l.fire("ShowPopup","",{title:"",msg:[""]})})},"initButton");var lt,at=!1,Et="  ",Ut=" \u2705",Kt="  ",jt=o(e=>{lt=e,l.on("CheckBoxTouched",lt,()=>{at=!at,Et=at?Ut:Kt,l.fire("UpdateButton",lt,{text:Et,color:"green",enabled:!0})})},"initCheckbox");var yt,Gt=o(e=>{yt=e,l.on("ButtonTouched",yt,()=>{console.log("window.close"),self.close()})},"initCloseButton");var C={Calc:"Caluculate",LineStart:"LineStart",LineEnd:"LineEnd",TxtStart:"TextStart",TxtEnd:"TextEnd"};var ct="";function vt(e){ct=e}o(vt,"setClipboard");function dt(e,t){if(t.code==="KeyA"){e.selectStart=0,e.selectEnd=e.fullText.length;for(let i of e.lines)i.hasSelection=!0;e.updateText(e.id,!0,"Select-All")}if(t.code==="KeyX"){e.insertionColumn>=e.selectEnd&&(e.insertionColumn=e.selectStart);let i=Lt(e);i.length>0&&(vt(i),b(e),e.refreshLines())}if(t.code==="KeyC"){let i=Lt(e);i.length>0&&(vt(i),e.selecting=!1,e.selectEnd=0,e.selectStart=0,e.refreshLines())}t.code==="KeyV"&&P(e,ct)}o(dt,"handleEditEvents");function Lt(e){return e.selectStart===0&&e.selectEnd===0?"":e.fullText.substring(e.selectStart,e.selectEnd-1)}o(Lt,"getSelectedText");function b(e){let t=e.fullText.substring(0,e.selectStart),i=e.fullText.substring(e.selectEnd);e.fullText=t+i,e.refreshLines()}o(b,"removeSelection");function P(e,t=ct){if(e.resetSelectionState(),t===`
`?(t+=L,e.insertionColumn=0):e.insertionColumn+=1,e.insertionIndex<e.fullText.length){let i=e.fullText.substring(0,e.insertionIndex),n=e.fullText.substring(e.insertionIndex);e.fullText=i+t+n,e.insertionColumn+=t.length-1}else e.fullText+=t,e.insertionColumn+=t.length;e.refreshLines()}o(P,"insertChars");function ft(e,t,i){return e>=t&&e<=i}o(ft,"isBetween");function ut(e,t){let i=[],n=t,h="",r=0;e.length<=1&&(e=L);let a=e.split(" ");for(let d of a)for(let[E,f]of d.split(`
`).entries()){if(E>0){r=Math.max(r,s.measureText(h).width),i.push(h),h=f,s.measureText(h).width>n&&(h=Pt(i,h,n,r));continue}let S=h===""?"":" ";s.measureText(h+S+f).width<=n?h+=S+f:s.measureText(f).width>n?(i.push(h),h=f,h=Pt(i,h,n,r)):(r=Math.max(r,s.measureText(h).width),i.push(h),h=f)}return r=Math.max(r,s.measureText(h).width),i.push(h),Xt(i)}o(ut,"getLines");function Xt(e){let t=0,i=[],n=0;for(let h of e)h.length>1&&h.startsWith(L),i.push({index:n,text:h,start:t,end:t+h.length,length:h.length,hasSelection:!1}),t+=h.length+1,n++;return i}o(Xt,"buildTextLines");function Pt(e,t,i,n){let h=t.split(""),r="";for(let a of h)s.measureText(r+a+"-").width<=i?r+=a:(n=Math.max(n,s.measureText(r+"-").width),e.push(r+"-"),r=a);return r}o(Pt,"charLines");var pt=class{static{o(this,"TextEditor")}id="";textCapacity=0;rowCapacity=0;containerSize={width:0,height:0};fullText="";lines=[];focused=!1;selecting=!1;insertionColumn=0;insertionRow=0;insertionIndex=0;selectStart=0;selectEnd=0;constructor(t,i=""){this.fullText=i,this.id=t,l.on("TextMetrics",this.id,n=>{this.containerSize=n.size,this.textCapacity=n.capacity.columns-1,this.rowCapacity=n.capacity.rows,this.refreshLines(C.TxtEnd)}),l.on("TextViewTouched",this.id,()=>{this.updateText(this.id,!0,"TextViewTouched")}),l.on("Focused",this.id,n=>{this.updateText(this.id,n,"Focused")}),l.on("WindowInput",this.id,n=>{P(this,n.data)}),l.on("WindowKeyDown",this.id,n=>{let{ctrlKey:h,shiftKey:r}=n;if(h){dt(this,n);return}switch(this.focused=!0,n.code){case"Backspace":this.insertionColumn>0&&this.insertionIndex>0?(this.selectStart=this.insertionIndex-1,this.selectEnd=this.insertionIndex,b(this),this.resetSelectionState()):(this.insertionRow>0&&(this.insertionRow-=1,this.insertionColumn=this.lines[this.insertionRow].length,this.refreshLines()),this.selectStart=this.insertionIndex-1,this.selectEnd=this.insertionIndex,b(this),this.resetSelectionState());break;case"Delete":{this.hasSelection()&&r?(b(this),this.resetSelectionState()):this.insertionIndex<this.fullText.length&&(this.selectStart=this.insertionIndex,this.selectEnd=this.insertionIndex+1,b(this),this.resetSelectionState());break}case"ArrowDown":this.hasText()===!0&&(this.insertionRow<this.lines.length-1&&(this.insertionRow+=1),r?(this.selecting||(this.selectStart=this.insertionIndex,this.selecting=!0),this.insertionColumn=this.lines[this.insertionRow].length,this.selectEnd=this.fullText.length):this.resetSelectionState()),this.updateInsertionPoint("DwnArrow");break;case"End":r?(this.selecting||(this.selectStart=this.insertionIndex,this.selecting=!0),this.selectEnd=this.lines[this.insertionRow].end):(this.insertionColumn=this.lines[this.insertionRow].length,this.resetSelectionState()),this.updateInsertionPoint(`Home Shift = ${r}`);break;case"Enter":P(this,`
`);break;case"Home":r?(this.selecting||(this.selectEnd=this.insertionIndex,this.selecting=!0),this.selectStart=this.lines[this.insertionRow].start):(this.insertionColumn=0,this.resetSelectionState()),this.updateInsertionPoint(`Home Shift = ${r}`);break;case"Insert":r&&(P(this),this.refreshLines());break;case"ArrowLeft":this.insertionIndex>0&&(this.insertionColumn-=1,this.insertionColumn<0&&(this.insertionRow-=1,this.insertionRow<0&&(this.insertionRow=0),this.insertionColumn=this.lines[this.insertionRow].length),r?(this.selecting||(this.selectEnd=this.insertionIndex+1,this.selecting=!0),this.selectStart=this.insertionIndex-1):this.resetSelectionState(),this.updateInsertionPoint(`LeftArrow Shift = ${r}`));break;case"ArrowRight":{this.insertionIndex<this.fullText.length&&(this.insertionColumn+=1,this.insertionColumn>this.lines[this.insertionRow].length&&(this.insertionRow+=1,this.insertionRow>this.lines.length?this.insertionRow=this.lines.length:this.insertionColumn=0),r?this.insertionIndex<this.lines[this.insertionRow].end&&(this.selecting||(this.selectStart=this.insertionIndex,this.selecting=!0),this.selectEnd=this.insertionIndex+1):this.resetSelectionState()),this.updateInsertionPoint(`RightArrow Shift = ${r}`);break}case"ArrowUp":this.hasText()===!0&&this.insertionRow>0&&(this.insertionRow-=1,r?(this.selecting||(this.selectEnd=this.insertionIndex,this.selecting=!0),this.insertionColumn=0,this.selectStart=0):this.resetSelectionState()),this.updateInsertionPoint("UpArrow");break;default:break}})}resetSelectionState(){this.selecting=!1,this.selectEnd=0,this.selectStart=0;for(let t of this.lines)t.hasSelection=!1}hasText(){return this.fullText.length>0}refreshLines(t=C.Calc){let i=this.lines.length;this.lines=ut(this.fullText,this.containerSize.width-5),this.lines.length>i?this.insertionRow+=1:this.lines.length<i&&this.insertionRow>this.lines.length-1&&(this.insertionRow=this.lines.length-1,this.insertionRow<0&&(this.insertionRow=0)),this.updateInsertionPoint("refreshLines",t)}updateInsertionPoint(t,i=C.Calc){switch(i){case C.Calc:{for(let n of this.lines)this.testForSelection(n),this.insertionRow===n.index&&(this.insertionColumn>n.length&&(this.insertionColumn=n.length),this.insertionIndex=n.start+this.insertionColumn);break}case C.TxtStart:this.insertionRow=0,this.insertionColumn=0,this.insertionIndex=0;break;case C.TxtEnd:this.insertionIndex=this.fullText.length,this.insertionRow=this.lastLineIndex(),this.insertionColumn=this.lines[this.insertionRow].length;break;default:break}this.updateText(this.id,!0,t)}hasSelection(){return this.selectEnd-this.selectStart>0}testForSelection(t){if(!this.hasSelection()){t.hasSelection=!1;return}let{start:i,end:n}=t;if(ft(this.selectStart,i,n)){t.hasSelection=!0;return}if(ft(this.selectEnd,i,n)){t.hasSelection=!0;return}}lastLineIndex(){return this.lines.length-1}updateText(t,i,n){this.focused=i,l.fire("UpdateTextArea",t,{reason:n,text:this.fullText,lines:this.lines,focused:this.focused,insertionColumn:this.insertionColumn,insertionRow:this.insertionRow,selectStart:this.selectStart,selectEnd:this.selectEnd})}};export{A as Button,Y as CARETBAR,me as CHECKEDBOX,we as CHECKMARK,pe as CLOSE,xe as CUT,N as Container,ue as EDIT,Ct as HAIRSPACE,L as PLACEHOLDER,H as Popup,ge as TRASH,V as TextArea,pt as TextEditor,B as TextElem,m as activeNodes,kt as addElement,tt as addNode,St as buildSignalAggregator,R as canvas,$t as containerInit,s as ctx,K as elementDescriptors,Ot as fontColor,q as getFactories,ut as getLines,dt as handleEditEvents,k as hasVisiblePopup,Vt as hydrateUI,Q as incrementTickCount,Ft as initButton,J as initCFG,jt as initCheckbox,Gt as initCloseButton,rt as initHostEvents,zt as refreshCanvasContext,b as removeSelection,Mt as renderAll,et as renderNodes,D as setHasVisiblePopup,Z as setupRenderContext,l as signals,U as tickCount,x as windowCFG};
